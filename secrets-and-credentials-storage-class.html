<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>StorageClass Secrets - Kubernetes CSI Developer Documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This site documents how to develop and deploy a Container Storage Interface (CSI) driver on Kubernetes.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="developing.html"><strong aria-hidden="true">2.</strong> Developing a CSI Driver for Kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="project-policies.html"><strong aria-hidden="true">2.1.</strong> Versioning, Support, Compatibility Policies</a></li><li class="chapter-item expanded "><a href="kubernetes-changelog.html"><strong aria-hidden="true">2.2.</strong> Kubernetes Changelog</a></li><li class="chapter-item expanded "><a href="kubernetes-cluster-controllers.html"><strong aria-hidden="true">2.3.</strong> Kubernetes Cluster Controllers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="snapshot-controller.html"><strong aria-hidden="true">2.3.1.</strong> Snapshot Controller</a></li><li class="chapter-item expanded "><a href="snapshot-validation-webhook.html"><strong aria-hidden="true">2.3.2.</strong> Snapshot Validation Webhook</a></li><li class="chapter-item expanded "><a href="csi-proxy.html"><strong aria-hidden="true">2.3.3.</strong> CSI Proxy</a></li></ol></li><li class="chapter-item expanded "><a href="sidecar-containers.html"><strong aria-hidden="true">2.4.</strong> Sidecar Containers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="external-attacher.html"><strong aria-hidden="true">2.4.1.</strong> external-attacher</a></li><li class="chapter-item expanded "><a href="external-provisioner.html"><strong aria-hidden="true">2.4.2.</strong> external-provisioner</a></li><li class="chapter-item expanded "><a href="external-resizer.html"><strong aria-hidden="true">2.4.3.</strong> external-resizer</a></li><li class="chapter-item expanded "><a href="external-snapshotter.html"><strong aria-hidden="true">2.4.4.</strong> external-snapshotter</a></li><li class="chapter-item expanded "><a href="livenessprobe.html"><strong aria-hidden="true">2.4.5.</strong> livenessprobe</a></li><li class="chapter-item expanded "><a href="node-driver-registrar.html"><strong aria-hidden="true">2.4.6.</strong> node-driver-registrar</a></li><li class="chapter-item expanded "><a href="cluster-driver-registrar.html"><strong aria-hidden="true">2.4.7.</strong> cluster-driver-registrar</a></li><li class="chapter-item expanded "><a href="external-health-monitor-controller.html"><strong aria-hidden="true">2.4.8.</strong> external-health-monitor-controller</a></li><li class="chapter-item expanded "><a href="external-health-monitor-agent.html"><strong aria-hidden="true">2.4.9.</strong> external-health-monitor-agent</a></li></ol></li><li class="chapter-item expanded "><a href="csi-objects.html"><strong aria-hidden="true">2.5.</strong> CSI objects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="csi-driver-object.html"><strong aria-hidden="true">2.5.1.</strong> CSIDriver Object</a></li><li class="chapter-item expanded "><a href="csi-node-object.html"><strong aria-hidden="true">2.5.2.</strong> CSINode Object</a></li></ol></li><li class="chapter-item expanded "><a href="features.html"><strong aria-hidden="true">2.6.</strong> Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="secrets-and-credentials.html"><strong aria-hidden="true">2.6.1.</strong> Secrets &amp; Credentials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="secrets-and-credentials-storage-class.html" class="active"><strong aria-hidden="true">2.6.1.1.</strong> StorageClass Secrets</a></li><li class="chapter-item expanded "><a href="secrets-and-credentials-volume-snapshot-class.html"><strong aria-hidden="true">2.6.1.2.</strong> VolumeSnapshotClass Secrets</a></li></ol></li><li class="chapter-item expanded "><a href="topology.html"><strong aria-hidden="true">2.6.2.</strong> Topology</a></li><li class="chapter-item expanded "><a href="raw-block.html"><strong aria-hidden="true">2.6.3.</strong> Raw Block Volume</a></li><li class="chapter-item expanded "><a href="skip-attach.html"><strong aria-hidden="true">2.6.4.</strong> Skip Attach</a></li><li class="chapter-item expanded "><a href="pod-info.html"><strong aria-hidden="true">2.6.5.</strong> Pod Info on Mount</a></li><li class="chapter-item expanded "><a href="volume-expansion.html"><strong aria-hidden="true">2.6.6.</strong> Volume expansion</a></li><li class="chapter-item expanded "><a href="volume-datasources.html"><strong aria-hidden="true">2.6.7.</strong> Data Sources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="volume-cloning.html"><strong aria-hidden="true">2.6.7.1.</strong> Cloning</a></li><li class="chapter-item expanded "><a href="snapshot-restore-feature.html"><strong aria-hidden="true">2.6.7.2.</strong> Volume Snapshot &amp; Restore</a></li></ol></li><li class="chapter-item expanded "><a href="ephemeral-local-volumes.html"><strong aria-hidden="true">2.6.8.</strong> Ephemeral Local Volumes</a></li><li class="chapter-item expanded "><a href="volume-limits.html"><strong aria-hidden="true">2.6.9.</strong> Volume Limits</a></li><li class="chapter-item expanded "><a href="storage-capacity-tracking.html"><strong aria-hidden="true">2.6.10.</strong> Storage Capacity Tracking</a></li><li class="chapter-item expanded "><a href="volume-health-monitor.html"><strong aria-hidden="true">2.6.11.</strong> Volume Health Monitoring</a></li><li class="chapter-item expanded "><a href="token-requests.html"><strong aria-hidden="true">2.6.12.</strong> Token Requests</a></li><li class="chapter-item expanded "><a href="support-fsgroup.html"><strong aria-hidden="true">2.6.13.</strong> FSGroup Support</a></li><li class="chapter-item expanded "><a href="csi-windows.html"><strong aria-hidden="true">2.6.14.</strong> CSI Windows</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="deploying.html"><strong aria-hidden="true">3.</strong> Deploying a CSI Driver on Kubernetes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="example.html"><strong aria-hidden="true">3.1.</strong> Example</a></li></ol></li><li class="chapter-item expanded "><a href="testing-drivers.html"><strong aria-hidden="true">4.</strong> Driver Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="unit-testing.html"><strong aria-hidden="true">4.1.</strong> Unit Testing</a></li><li class="chapter-item expanded "><a href="functional-testing.html"><strong aria-hidden="true">4.2.</strong> Functional Testing</a></li></ol></li><li class="chapter-item expanded "><a href="drivers.html"><strong aria-hidden="true">5.</strong> Drivers</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">6.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Kubernetes CSI Developer Documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#storageclass-secrets" id="storageclass-secrets">StorageClass Secrets</a></h1>
<p>The CSI <a href="external-provisioner.html">external-provisioner</a> sidecar container facilitates the handling of secrets for the following operations:</p>
<ul>
<li><code>CreateVolumeRequest</code></li>
<li><code>DeleteVolumeRequest</code></li>
<li><code>ControllerPublishVolumeRequest</code></li>
<li><code>ControllerUnpublishVolumeRequest</code></li>
<li><code>ControllerExpandVolumeRequest</code></li>
<li><code>NodeStageVolumeRequest</code></li>
<li><code>NodePublishVolumeRequest</code></li>
</ul>
<p>CSI <code>external-provisioner</code> v1.0.1+ supports the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/provisioner-secret-name</code></li>
<li><code>csi.storage.k8s.io/provisioner-secret-namespace</code></li>
<li><code>csi.storage.k8s.io/controller-publish-secret-name</code></li>
<li><code>csi.storage.k8s.io/controller-publish-secret-namespace</code></li>
<li><code>csi.storage.k8s.io/node-stage-secret-name</code></li>
<li><code>csi.storage.k8s.io/node-stage-secret-namespace</code></li>
<li><code>csi.storage.k8s.io/node-publish-secret-name</code></li>
<li><code>csi.storage.k8s.io/node-publish-secret-namespace</code></li>
</ul>
<p>CSI <code>external-provisioner</code> v1.2.0+ adds support for the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/controller-expand-secret-name</code></li>
<li><code>csi.storage.k8s.io/controller-expand-secret-namespace</code></li>
</ul>
<p>Cluster admins can populate the secret fields for the operations listed above with data from Kubernetes <code>Secret</code> objects by specifying these keys in the <code>StorageClass</code> object.</p>
<h2><a class="header" href="#examples" id="examples">Examples</a></h2>
<h3><a class="header" href="#basic-provisioning-secret" id="basic-provisioning-secret">Basic Provisioning Secret</a></h3>
<p>In this example, the external-provisioner will fetch Kubernetes <code>Secret</code> object <code>fast-storage-provision-key</code> in the namespace <code>pd-ssd-credentials</code> and pass the credentials to the CSI driver named <code>csi-driver.team.example.com</code> in the <code>CreateVolume</code> CSI call.</p>
<pre><code class="language-yaml">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: fast-storage
provisioner: csi-driver.team.example.com
parameters:
  type: pd-ssd
  csi.storage.k8s.io/provisioner-secret-name: fast-storage-provision-key
  csi.storage.k8s.io/provisioner-secret-namespace: pd-ssd-credentials
</code></pre>
<p>All volumes provisioned using this <code>StorageClass</code> use the same secret.</p>
<h3><a class="header" href="#per-volume-secrets" id="per-volume-secrets">Per Volume Secrets</a></h3>
<p>In this example, the external-provisioner will generate the name of the Kubernetes <code>Secret</code> object and namespace for the <code>NodePublishVolume</code> CSI call, based on the PVC namespace and annotations, at volume provision time.</p>
<pre><code class="language-yaml">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: fast-storage
provisioner: csi-driver.team.example.com
parameters:
  type: pd-ssd
  csi.storage.k8s.io/node-publish-secret-name: ${pvc.annotations['team.example.com/key']}
  csi.storage.k8s.io/node-publish-secret-namespace: ${pvc.namespace}
</code></pre>
<p>This StorageClass will result in the creation of a <code>PersistentVolume</code> API object referencing a &quot;node publish secret&quot; in the same namespace as the <code>PersistentVolumeClaim</code> that triggered the provisioning and with a name specified as an annotation on the <code>PersistentVolumeClaim</code>. This could be used to give the creator of the <code>PersistentVolumeClaim</code> the ability to specify a secret containing a decryption key they have control over.</p>
<h3><a class="header" href="#multiple-operation-secrets" id="multiple-operation-secrets">Multiple Operation Secrets</a></h3>
<p>A drivers may support secret keys for multiple operations. In this case, you can provide secrets references for each operation:</p>
<pre><code class="language-yaml">kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: fast-storage-all
provisioner: csi-driver.team.example.com
parameters:
  type: pd-ssd
  csi.storage.k8s.io/provisioner-secret-name: ${pvc.name}
  csi.storage.k8s.io/provisioner-secret-namespace: ${pvc.namespace}-fast-storage
  csi.storage.k8s.io/node-publish-secret-name: ${pvc.name}-${pvc.annotations['team.example.com/key']}
  csi.storage.k8s.io/node-publish-secret-namespace: ${pvc.namespace}-fast-storage
  
</code></pre>
<h2><a class="header" href="#operations" id="operations">Operations</a></h2>
<p>Details for each secret supported by the external-provisioner can be found below.</p>
<h3><a class="header" href="#createdelete-volume-secret" id="createdelete-volume-secret">Create/Delete Volume Secret</a></h3>
<p>The CSI <code>external-provisioner</code> (v1.0.1+) looks for the following keys in <code>StorageClass.parameters</code>.</p>
<ul>
<li><code>csi.storage.k8s.io/provisioner-secret-name</code></li>
<li><code>csi.storage.k8s.io/provisioner-secret-namespace</code></li>
</ul>
<p>The values of both of these parameters, together, refer to the name and namespace of a <code>Secret</code> object in the Kubernetes API.</p>
<p>If specified, the CSI <code>external-provisioner</code> will attempt to fetch the secret before provisioning and deletion.</p>
<p>If the secret is retrieved successfully, the provisioner passes it to the CSI driver in the <code>CreateVolumeRequest.secrets</code> or <code>DeleteVolumeRequest.secrets</code> field.</p>
<p>If no such secret exists in the Kubernetes API, or the provisioner is unable to fetch it, the provision operation will fail.</p>
<p>Note, however, that the delete operation will continue even if the secret is not found (because, for example, the entire namespace containing the secret was deleted). In this case, if the driver requires a secret for deletion, then the volume and PV may need to be manually cleaned up.</p>
<p>The values of these parameters may be &quot;templates&quot;. The <code>external-provisioner</code> will automatically resolve templates at volume provision time, as detailed below:</p>
<ul>
<li><code>csi.storage.k8s.io/provisioner-secret-name</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
<li>Support added in CSI <code>external-provisioner</code> v1.2.0+</li>
</ul>
</li>
<li><code>${pvc.name}</code>
<ul>
<li>Replaced with the name of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
<li>Support added in CSI <code>external-provisioner</code> v1.2.0+</li>
</ul>
</li>
</ul>
</li>
<li><code>csi.storage.k8s.io/provisioner-secret-namespace</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#controller-publishunpublish-secret" id="controller-publishunpublish-secret">Controller Publish/Unpublish Secret</a></h3>
<p>The CSI <code>external-provisioner</code> (v1.0.1+) looks for the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/controller-publish-secret-name</code></li>
<li><code>csi.storage.k8s.io/controller-publish-secret-namespace</code></li>
</ul>
<p>The values of both of these parameters, together, refer to the name and namespace of a <code>Secret</code> object in the Kubernetes API.</p>
<p>If specified, the CSI <code>external-provisioner</code> sets the <code>CSIPersistentVolumeSource.ControllerPublishSecretRef</code> field in the new <code>PersistentVolume</code> object to refer to this secret once provisioning is successful.</p>
<p>The CSI <code>external-attacher</code> then attempts to fetch the secret referenced by the <code>CSIPersistentVolumeSource.ControllerPublishSecretRef</code>, if specified, before an attach or detach operation.</p>
<p>If no such secret exists in the Kubernetes API, or the <code>external-attacher</code> is unable to fetch it, the attach or detach operation fails.</p>
<p>If the secret is retrieved successfully, the <code>external-attacher</code> passes it to the CSI driver in the <code>ControllerPublishVolumeRequest.secrets</code> or <code>ControllerUnpublishVolumeRequest.secrets</code> field.</p>
<p>The values of these parameters may be &quot;templates&quot;. The <code>external-provisioner</code> will automatically resolve templates at volume provision time, as detailed below:</p>
<ul>
<li><code>csi.storage.k8s.io/controller-publish-secret-name</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.name}</code>
<ul>
<li>Replaced with the name of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.annotations['&lt;ANNOTATION_KEY&gt;']}</code> (e.g. <code>${pvc.annotations['example.com/key']}</code>)
<ul>
<li>Replaced with the value of the specified annotation from the <code>PersistentVolumeClaim</code> object that triggered provisioning</li>
</ul>
</li>
</ul>
</li>
<li><code>csi.storage.k8s.io/controller-publish-secret-namespace</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#node-stage-secret" id="node-stage-secret">Node Stage Secret</a></h3>
<p>The CSI <code>external-provisioner</code> (v1.0.1+) looks for the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/node-stage-secret-name</code></li>
<li><code>csi.storage.k8s.io/node-stage-secret-namespace</code></li>
</ul>
<p>The value of both parameters, together, refer to the name and namespace of the <code>Secret</code> object in the Kubernetes API.</p>
<p>If specified, the CSI <code>external-provisioner</code> sets the <code>CSIPersistentVolumeSource.NodeStageSecretRef</code> field in the new <code>PersistentVolume</code> object to refer to this secret once provisioning is successful.</p>
<p>The Kubernetes kubelet then attempts to fetch the secret referenced by the <code>CSIPersistentVolumeSource.NodeStageSecretRef</code> field, if specified, before a mount device operation.</p>
<p>If no such secret exists in the Kubernetes API, or the kubelet is unable to fetch it, the mount device operation fails.</p>
<p>If the secret is retrieved successfully, the kubelet passes it to the CSI driver in the <code>NodeStageVolumeRequest.secrets</code> field.</p>
<p>The values of these parameters may be &quot;templates&quot;. The <code>external-provisioner</code> will automatically resolve templates at volume provision time, as detailed below:</p>
<ul>
<li><code>csi.storage.k8s.io/node-stage-secret-name</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.name}</code>
<ul>
<li>Replaced with the name of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.annotations['&lt;ANNOTATION_KEY&gt;']}</code> (e.g. <code>${pvc.annotations['example.com/key']}</code>)
<ul>
<li>Replaced with the value of the specified annotation from the <code>PersistentVolumeClaim</code> object that triggered provisioning</li>
</ul>
</li>
</ul>
</li>
<li><code>csi.storage.k8s.io/node-stage-secret-namespace</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#node-publish-secret" id="node-publish-secret">Node Publish Secret</a></h3>
<p>The CSI <code>external-provisioner</code> (v1.0.1+) looks for the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/node-publish-secret-name</code></li>
<li><code>csi.storage.k8s.io/node-publish-secret-namespace</code></li>
</ul>
<p>The value of both parameters, together, refer to the name and namespace of the <code>Secret</code> object in the Kubernetes API.</p>
<p>If specified, the CSI <code>external-provisioner</code> sets the <code>CSIPersistentVolumeSource.NodePublishSecretRef</code> field in the new <code>PersistentVolume</code> object to refer to this secret once provisioning is successful.</p>
<p>The Kubernetes kubelet, attempts to fetch the secret referenced by the <code>CSIPersistentVolumeSource.NodePublishSecretRef</code> field, if specified, before a mount operation.</p>
<p>If no such secret exists in the Kubernetes API, or the kubelet is unable to fetch it, the mount operation fails.</p>
<p>If the secret is retrieved successfully, the kubelet passes it to the CSI driver in the <code>NodePublishVolumeRequest.secrets</code> field.</p>
<p>The values of these parameters may be &quot;templates&quot;. The <code>external-provisioner</code> will automatically resolve templates at volume provision time, as detailed below:</p>
<ul>
<li><code>csi.storage.k8s.io/node-publish-secret-name</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.name}</code>
<ul>
<li>Replaced with the name of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.annotations['&lt;ANNOTATION_KEY&gt;']}</code> (e.g. <code>${pvc.annotations['example.com/key']}</code>)
<ul>
<li>Replaced with the value of the specified annotation from the <code>PersistentVolumeClaim</code> object that triggered provisioning</li>
</ul>
</li>
</ul>
</li>
<li><code>csi.storage.k8s.io/node-publish-secret-namespace</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="header" href="#controller-expand-volume-resize-secret" id="controller-expand-volume-resize-secret">Controller Expand (Volume Resize) Secret</a></h3>
<p>The CSI <code>external-provisioner</code> (v1.2.0+) looks for the following keys in <code>StorageClass.parameters</code>:</p>
<ul>
<li><code>csi.storage.k8s.io/controller-expand-secret-name</code></li>
<li><code>csi.storage.k8s.io/controller-expand-secret-namespace</code></li>
</ul>
<p>The value of both parameters, together, refer to the name and namespace of the <code>Secret</code> object in the Kubernetes API.</p>
<p>If specified, the CSI <code>external-provisioner</code> sets the <code>CSIPersistentVolumeSource.ControllerExpandSecretRef</code> field in the new <code>PersistentVolume</code> object to refer to this secret once provisioning is successful.</p>
<p>The <code>external-resizer</code> (v0.2.0+), attempts to fetch the secret referenced by the <code>CSIPersistentVolumeSource.ControllerExpandSecretRef</code> field, if specified, before starting a volume resize (expand) operation.</p>
<p>If no such secret exists in the Kubernetes API, or the <code>external-resizer</code> is unable to fetch it, the resize (expand) operation fails.</p>
<p>If the secret is retrieved successfully, the <code>external-resizer</code> passes it to the CSI driver in the <code>ControllerExpandVolumeRequest.secrets</code> field.</p>
<p>The values of these parameters may be &quot;templates&quot;. The <code>external-provisioner</code> will automatically resolve templates at volume provision time, as detailed below:</p>
<ul>
<li><code>csi.storage.k8s.io/controller-expand-secret-name</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.name}</code>
<ul>
<li>Replaced with the name of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
<li><code>${pvc.annotations['&lt;ANNOTATION_KEY&gt;']}</code> (e.g. <code>${pvc.annotations['example.com/key']}</code>)
<ul>
<li>Replaced with the value of the specified annotation from the <code>PersistentVolumeClaim</code> object that triggered provisioning</li>
</ul>
</li>
</ul>
</li>
<li><code>csi.storage.k8s.io/controller-expand-secret-namespace</code>
<ul>
<li><code>${pv.name}</code>
<ul>
<li>Replaced with name of the <code>PersistentVolume</code> object being provisioned.</li>
</ul>
</li>
<li><code>${pvc.namespace}</code>
<ul>
<li>Replaced with namespace of the <code>PersistentVolumeClaim</code> object that triggered provisioning.</li>
</ul>
</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="secrets-and-credentials.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="secrets-and-credentials-volume-snapshot-class.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="secrets-and-credentials.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="secrets-and-credentials-volume-snapshot-class.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
