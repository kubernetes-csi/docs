<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSIDriver Object - Kubernetes CSI Developer Documentation</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This site documents how to develop and deploy a Container Storage Interface (CSI) driver on Kubernetes.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><a href="developing.html"><strong aria-hidden="true">2.</strong> Developing a CSI Driver for Kubernetes</a></li><li><ol class="section"><li><a href="kubernetes-changelog.html"><strong aria-hidden="true">2.1.</strong> Kubernetes Changelog</a></li><li><a href="kubernetes-cluster-controllers.html"><strong aria-hidden="true">2.2.</strong> Kubernetes Cluster Controllers</a></li><li><ol class="section"><li><a href="snapshot-controller.html"><strong aria-hidden="true">2.2.1.</strong> Snapshot Controller</a></li></ol></li><li><a href="sidecar-containers.html"><strong aria-hidden="true">2.3.</strong> Sidecar Containers</a></li><li><ol class="section"><li><a href="kubernetes-compatibility.html"><strong aria-hidden="true">2.3.1.</strong> Kubernetes Compatibility</a></li><li><a href="external-attacher.html"><strong aria-hidden="true">2.3.2.</strong> external-attacher</a></li><li><a href="external-provisioner.html"><strong aria-hidden="true">2.3.3.</strong> external-provisioner</a></li><li><a href="external-resizer.html"><strong aria-hidden="true">2.3.4.</strong> external-resizer</a></li><li><a href="external-snapshotter.html"><strong aria-hidden="true">2.3.5.</strong> external-snapshotter</a></li><li><a href="livenessprobe.html"><strong aria-hidden="true">2.3.6.</strong> livenessprobe</a></li><li><a href="node-driver-registrar.html"><strong aria-hidden="true">2.3.7.</strong> node-driver-registrar</a></li><li><a href="cluster-driver-registrar.html"><strong aria-hidden="true">2.3.8.</strong> cluster-driver-registrar</a></li></ol></li><li><a href="csi-objects.html"><strong aria-hidden="true">2.4.</strong> CSI objects</a></li><li><ol class="section"><li><a href="csi-driver-object.html" class="active"><strong aria-hidden="true">2.4.1.</strong> CSIDriver Object</a></li><li><a href="csi-node-object.html"><strong aria-hidden="true">2.4.2.</strong> CSINode Object</a></li></ol></li><li><a href="features.html"><strong aria-hidden="true">2.5.</strong> Features</a></li><li><ol class="section"><li><a href="secrets-and-credentials.html"><strong aria-hidden="true">2.5.1.</strong> Secrets &amp; Credentials</a></li><li><ol class="section"><li><a href="secrets-and-credentials-storage-class.html"><strong aria-hidden="true">2.5.1.1.</strong> StorageClass Secrets</a></li><li><a href="secrets-and-credentials-volume-snapshot-class.html"><strong aria-hidden="true">2.5.1.2.</strong> VolumeSnapshotClass Secrets</a></li></ol></li><li><a href="topology.html"><strong aria-hidden="true">2.5.2.</strong> Topology</a></li><li><a href="raw-block.html"><strong aria-hidden="true">2.5.3.</strong> Raw Block Volume</a></li><li><a href="skip-attach.html"><strong aria-hidden="true">2.5.4.</strong> Skip Attach</a></li><li><a href="pod-info.html"><strong aria-hidden="true">2.5.5.</strong> Pod Info on Mount</a></li><li><a href="volume-expansion.html"><strong aria-hidden="true">2.5.6.</strong> Volume expansion</a></li><li><a href="volume-datasources.html"><strong aria-hidden="true">2.5.7.</strong> Data Sources</a></li><li><ol class="section"><li><a href="volume-cloning.html"><strong aria-hidden="true">2.5.7.1.</strong> Cloning</a></li><li><a href="snapshot-restore-feature.html"><strong aria-hidden="true">2.5.7.2.</strong> Volume Snapshot &amp; Restore</a></li></ol></li><li><a href="ephemeral-local-volumes.html"><strong aria-hidden="true">2.5.8.</strong> Ephemeral Local Volumes</a></li><li><a href="volume-limits.html"><strong aria-hidden="true">2.5.9.</strong> Volume Limits</a></li></ol></li></ol></li><li><a href="deploying.html"><strong aria-hidden="true">3.</strong> Deploying a CSI Driver on Kubernetes</a></li><li><ol class="section"><li><a href="example.html"><strong aria-hidden="true">3.1.</strong> Example</a></li></ol></li><li><a href="testing-drivers.html"><strong aria-hidden="true">4.</strong> Driver Testing</a></li><li><ol class="section"><li><a href="unit-testing.html"><strong aria-hidden="true">4.1.</strong> Unit Testing</a></li><li><a href="functional-testing.html"><strong aria-hidden="true">4.2.</strong> Functional Testing</a></li></ol></li><li><a href="drivers.html"><strong aria-hidden="true">5.</strong> Drivers</a></li><li><a href="troubleshooting.html"><strong aria-hidden="true">6.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Kubernetes CSI Developer Documentation</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#csidriver-object" id="csidriver-object">CSIDriver Object</a></h1>
<h2><a class="header" href="#status" id="status">Status</a></h2>
<ul>
<li>Kubernetes 1.12 - 1.13: Alpha</li>
<li>Kubernetes 1.14: Beta</li>
<li>Kubernetes 1.18: GA</li>
</ul>
<h2><a class="header" href="#what-is-the-csidriver-object" id="what-is-the-csidriver-object">What is the CSIDriver object?</a></h2>
<p>The <code>CSIDriver</code> Kubernetes API object serves two purposes:</p>
<ol>
<li>Simplify driver discovery</li>
</ol>
<ul>
<li>If a CSI driver creates a <code>CSIDriver</code> object, Kubernetes users can easily discover the CSI Drivers installed on their cluster (simply by issuing <code>kubectl get CSIDriver</code>)</li>
</ul>
<ol start="2">
<li>Customizing Kubernetes behavior</li>
</ol>
<ul>
<li>Kubernetes has a default set of behaviors when dealing with CSI Drivers (for example, it calls the <code>Attach</code>/<code>Detach</code> operations by default). This object allows CSI drivers to specify how Kubernetes should interact with it.</li>
</ul>
<h2><a class="header" href="#what-fields-does-the-csidriver-object-have" id="what-fields-does-the-csidriver-object-have">What fields does the <code>CSIDriver</code> object have?</a></h2>
<p>Here is an example of a v1 <code>CSIDriver</code> object:</p>
<pre><code class="language-YAML">apiVersion: storage.k8s.io/v1
kind: CSIDriver
metadata:
  name: mycsidriver.example.com
spec:
  attachRequired: true
  podInfoOnMount: true
  volumeLifecycleModes: # added in Kubernetes 1.16, this field is beta
  - Persistent
  - Ephemeral
</code></pre>
<p>There are four important fields:</p>
<ul>
<li><code>name</code>
<ul>
<li>This should correspond to the full name of the CSI driver.</li>
</ul>
</li>
<li><code>attachRequired</code>
<ul>
<li>Indicates this CSI volume driver requires an attach operation (because it implements the CSI <code>ControllerPublishVolume</code> method), and that Kubernetes should call attach and wait for any attach operation to complete before proceeding to mounting.</li>
<li>If a <code>CSIDriver</code> object does not exist for a given CSI Driver, the default is <code>true</code> -- meaning attach will be called.</li>
<li>If a <code>CSIDriver</code> object exists for a given CSI Driver, but this field is not specified, it also defaults to <code>true</code> -- meaning attach will be called.</li>
<li>For more information see <a href="skip-attach.html">Skip Attach</a>.</li>
</ul>
</li>
<li><code>podInfoOnMount</code>
<ul>
<li>Indicates this CSI volume driver requires additional pod information (like pod name, pod UID, etc.) during mount operations.</li>
<li>If value is not specified or <code>false</code>, pod information will not be passed on mount.</li>
<li>If value is set to <code>true</code>, Kubelet will pass pod information as <code>volume_context</code> in CSI <code>NodePublishVolume</code> calls:
<ul>
<li><code>&quot;csi.storage.k8s.io/pod.name&quot;: pod.Name</code></li>
<li><code>&quot;csi.storage.k8s.io/pod.namespace&quot;: pod.Namespace</code></li>
<li><code>&quot;csi.storage.k8s.io/pod.uid&quot;: string(pod.UID)</code></li>
<li><code>&quot;csi.storage.k8s.io/serviceAccount.name&quot;: pod.Spec.ServiceAccountName</code></li>
</ul>
</li>
<li>For more information see <a href="pod-info.html">Pod Info on Mount</a>.</li>
</ul>
</li>
<li><code>volumeLifecycleModes</code>
<ul>
<li>This field was added in Kubernetes 1.16 and cannot be set when using an older Kubernetes release.</li>
<li>This field is beta.</li>
<li>It informs Kubernetes about the volume modes that are supported by the driver.
This ensures that the driver <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-storage/20190122-csi-inline-volumes.md#support-for-inline-csi-volumes">is not used incorrectly</a> by users.
The default is <code>Persistent</code>, which is the normal PVC/PV mechanism. <code>Ephemeral</code> enables
<a href="ephemeral-local-volumes.html">inline ephemeral volumes</a> in addition (when both
are listed) or instead of normal volumes (when it is the only entry in the list).</li>
</ul>
</li>
</ul>
<h2><a class="header" href="#what-creates-the-csidriver-object" id="what-creates-the-csidriver-object">What creates the CSIDriver object?</a></h2>
<p>To install, a CSI driver's deployment manifest must contain a <code>CSIDriver</code>
object as shown in the example above.</p>
<blockquote>
<p>NOTE: The cluster-driver-registrar side-car which was used to create CSIDriver
objects in Kubernetes 1.13 has been deprecated for Kubernetes 1.16. No
cluster-driver-registrar has been released for Kubernetes 1.14 and later.</p>
</blockquote>
<p><code>CSIDriver</code> instance should exist for whole lifetime of all pods that use
volumes provided by corresponding CSI driver, so <a href="skip-attach.html">Skip Attach</a>
and <a href="pod-info.html">Pod Info on Mount</a> features work correctly.</p>
<h3><a class="header" href="#listing-registered-csi-drivers" id="listing-registered-csi-drivers">Listing registered CSI drivers</a></h3>
<p>Using the <code>CSIDriver</code> object, it is now possible to query Kubernetes to get a list of registered drivers running in the cluster as shown below:</p>
<pre><code>$&gt; kubectl get csidrivers.storage.k8s.io
NAME                  CREATED AT
hostpath.csi.k8s.io   2019-09-13T09:58:43Z
</code></pre>
<p>Or get a more detailed view of your registered driver with:</p>
<pre><code>$&gt; kubectl describe csidrivers.storage.k8s.io
Name:         hostpath.csi.k8s.io
Namespace:    
Labels:       &lt;none&gt;
Annotations:  kubectl.kubernetes.io/last-applied-configuration:
                {&quot;apiVersion&quot;:&quot;storage.k8s.io/v1&quot;,&quot;kind&quot;:&quot;CSIDriver&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;hostpath.csi.k8s.io&quot;},&quot;spec&quot;:{&quot;podInfoOnMou...
API Version:  storage.k8s.io/v1
Kind:         CSIDriver
Metadata:
  Creation Timestamp:  2019-09-13T09:58:43Z
  Resource Version:    341
  Self Link:           /apis/storage.k8s.io/v1/csidrivers/hostpath.csi.k8s.io
  UID:                 1860f2a1-85f8-4357-a933-c45e54f0c8e0
Spec:
  Attach Required:    true
  Pod Info On Mount:  true
  Volume Lifecycle Modes:
    Persistent
    Ephemeral
Events:  &lt;none&gt;
</code></pre>
<h2><a class="header" href="#changes-from-alpha-to-beta" id="changes-from-alpha-to-beta">Changes from Alpha to Beta</a></h2>
<h3><a class="header" href="#crd-to-built-in-type" id="crd-to-built-in-type">CRD to Built in Type</a></h3>
<p>During alpha development, the <code>CSIDriver</code> object was also defined as a <a href="https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#create-a-customresourcedefinition">Custom Resource Definition</a> (CRD). As part of the promotion to beta the object has been moved to the built-in Kubernetes API.</p>
<p>In the move from alpha to beta, the API Group for this object changed from <code>csi.storage.k8s.io/v1alpha1</code> to <code>storage.k8s.io/v1beta1</code>.</p>
<p>There is no automatic update of existing CRDs and their CRs during Kubernetes update to the new build-in type.</p>
<h3><a class="header" href="#enabling-csidriver-on-kubernetes" id="enabling-csidriver-on-kubernetes">Enabling CSIDriver on Kubernetes</a></h3>
<p>In Kubernetes v1.12 and v1.13, because the feature was alpha, it was disabled by default. To enable the use of <code>CSIDriver</code> on these versions, do the following:</p>
<ol>
<li>Ensure the feature gate is enabled via the following Kubernetes feature flag: <code>--feature-gates=CSIDriverRegistry=true</code></li>
<li>Either ensure the <code>CSIDriver</code> CRD is automatically installed via the <a href="https://github.com/kubernetes/kubernetes/tree/release-1.13/cluster/addons/storage-crds">Kubernetes Storage CRD addon</a> OR manually install the <code>CSIDriver</code> CRD on the Kubernetes cluster with the following command:</li>
</ol>
<pre><code>$&gt; kubectl create -f https://raw.githubusercontent.com/kubernetes/csi-api/master/pkg/crd/manifests/csidriver.yaml
</code></pre>
<p>Kubernetes v1.14+, uses the same Kubernetes feature flag, but because the feature is beta, it is enabled by default. And since the API type (as of beta) is built in to the Kubernetes API, installation of the CRD is no longer required.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="csi-objects.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="csi-node-object.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="csi-objects.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="csi-node-object.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
